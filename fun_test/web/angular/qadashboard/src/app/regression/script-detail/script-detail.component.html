<div class="fun-flex-container fun-action-nav">
    <span class="script-name">{{ scriptPath }}</span>
    <div class="fun-spacer"></div>
    <button (click)="onContextOptionsClick(contextOptions)" class="fun-button-add">Context options</button>
    <!--button (click)="testClick()">Test</button-->
    <ng-template #contextOptions let-modal>
      <div class="fun-panel">
        <div class="fun-panel-header">
          <span>Select contexts to display</span>
        </div>
        <div class="fun-panel-body">
          <ng-container *ngFor="let availableContext of availableContexts">
            <div>
              <input type="checkbox" [(ngModel)]="availableContext.selected" [checked]="availableContext?.selected">
              <span class="checkbox-text">ID : {{ availableContext.context_id }} ({{ availableContext.description }})</span>
            </div>

          </ng-container>

        </div>

      </div>

    </ng-template>
  </div>
<!--app-timeline-control *ngIf="showLogsPanel" [domainMin]="minRelativeTime" [domainMax]="maxRelativeTime" [title]="'Show logs starting from'" [unit]="'s'" (valueChanged)="onTimeLineChanged($event)"></app-timeline-control-->
<div class="component" style="overflow: hidden; position: fixed">
  <div class="fun-flex-container" style="align-items: flex-start;">
      <div *ngIf="showTestCasePanel" class="fun-flex-item panel fun-panel auto-scroll" [@show]="showTestCasePanel">
        <div class="fun-panel-header">Test-cases</div>
        <div>
          <table class="fun-table">
            <tr>
              <td class="fun-table-header">ID</td>
              <td class="fun-table-header">Description</td>
              <td class="fun-table-header">Result</td>
            </tr>
            <tr *ngFor="let testCaseExecution of testCaseExecutions; let index=index" [ngClass]="{'selected-row': currentTestCaseExecution?.test_case_id === testCaseExecution.test_case_id }">
              <td>
                <span class="pseudo-anchor" (click)="onTestCaseIdClick(index, testCaseExecution.execution_id)" >{{ testCaseExecution.test_case_id }}
                </span>
              </td>
              <td>{{ testCaseExecution.summary }}</td>
              <td><span [ngClass]="{'passed': testCaseExecution.result === 'PASSED', 'failed': testCaseExecution.result === 'FAILED' }">{{ testCaseExecution.result }}</span></td>
            </tr>
          </table>
        </div>
      </div>

      <div class="fun-flex-item panel fun-panel" [@show]="showCheckpointPanel" *ngIf="currentTestCaseExecution">
        <div class="fun-panel-header fun-flex-container" style="justify-content: space-between">
          <span>Checkpoints <small>(TC: {{ currentTestCaseExecution.test_case_id }}: {{ currentTestCaseExecution.summary }})</small></span>
          <span *ngIf="!showTestCasePanel" (click)="onShowTestCasePanelClick()" class="pseudo-anchor">< Show test-cases</span>
        </div>

        <div class="auto-scroll">
          <table class="fun-table">
            <tr>
              <td class="fun-table-header">Time</td>
              <td class="fun-table-header">ID</td>
              <td class="fun-table-header">Ctx</td>
              <td class="fun-table-header">Checkpoint</td>
              <td class="fun-table-header">Result</td>
              <td class="fun-table-header">Expected</td>
              <td class="fun-table-header">Actual</td>
            </tr>
            <tr *ngFor="let checkpoint of currentTestCaseExecution?.checkpoints" [ngClass]="{'selected-checkpoint-row': currentCheckpointIndex === checkpoint?.data?.checkpoint_index }">
              <td>
                {{ checkpoint.relative_epoch_time | number: '1.3-3'}}
              </td>
              <td *ngIf="checkpoint.data.checkpoint != 'Start'">
                <span class="pseudo-anchor" (click)="onCheckpointClick(currentTestCaseExecution, checkpoint.data.checkpoint_index, checkpoint.data.context_id)">{{ checkpoint.data.checkpoint_index }}
                </span>
              </td>
              <td>{{ checkpoint.data.context_id }}</td>
              <td>{{ checkpoint.data.checkpoint }}</td>
              <td><span [ngClass]="{'passed': checkpoint.data.result === 'PASSED', 'failed': checkpoint.data.result === 'FAILED' }">{{ checkpoint.data.result }}</span></td>
              <td>{{ checkpoint.data.expected }}</td>
              <td>{{ checkpoint.data.actual }}</td>
            </tr>
          </table>
        </div>
      </div>
      <div class="fun-flex-container" *ngIf="showLogsPanel" id="logs-panel">
        <ng-container *ngFor="let availableContext of (availableContexts | selected )">
          <div class="fun-flex-item panel fun-panel">
            <div class="fun-panel-header">
              Context: {{ availableContext.context_id }} {{ availableContext.description }}
            </div>
            <div class="fun-panel-body">
              <h4>{{ currentTestCaseExecution.test_case_id }}: {{ currentTestCaseExecution.summary }}</h4>
              <fun-spinner [status]="status"></fun-spinner>
              <div [@show]="showLogsPanel" *ngIf="currentTestCaseExecution" class="auto-scroll" >
                <div>
                  <ng-container>
                    <ng-container *ngIf="logsAreTruncated">
                      <div style="float: right" class="pseudo-anchor" (click)="showPreviousLogsClick()">Show previous logs</div>
                      <br>
                    </ng-container>
                    <table>
                      <ng-container *ngFor="let checkpoint of currentTestCaseExecution?.checkpoints">
                        <tr *ngFor="let seriesElement of checkpoint?.timeSeries">
                          <ng-container *ngIf="(seriesElement.data.context_id === availableContext.context_id) && (seriesElement.relative_epoch_time >= timeFilterMin)">
                            <ng-container *ngIf="seriesElement.type === 80 && (seriesElement.data.checkpoint_index <= currentCheckpointIndex)">

                              <td class="timestamp" nowrap><small>{{ seriesElement.relative_epoch_time | number: '1.3-3' }}</small></td>
                              <td>
                                <div id="{{ currentTestCaseExecution.test_case_id }}_{{ seriesElement.data?.checkpoint_index }}_{{ seriesElement.data?.context_id }}">
                                  <span class="checkpoint-span">Checkpoint: {{ seriesElement.data?.checkpoint }}
                                  </span>
                                </div>
                              </td>
                            </ng-container>
                          <ng-container *ngIf="seriesElement.type === 60 && (seriesElement.data.checkpoint_index <= currentCheckpointIndex)">
                            <td class="timestamp" nowrap><small>{{ seriesElement.relative_epoch_time | number: '1.3-3' }}</small></td>
                            <td><pre>{{ seriesElement.data?.log }}</pre></td>
                          </ng-container>
                        </ng-container>
                      </tr>
                      </ng-container>
                    </table>
                  </ng-container>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
</div>




