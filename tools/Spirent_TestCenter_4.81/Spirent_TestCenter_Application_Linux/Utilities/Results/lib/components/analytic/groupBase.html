<div ng-controller="resultCtrl">
<div ng-controller="toggleView">

    <!-- Loop through children -->
    <script type="text/ng-template" id="children">
        <div ng-include="'display'"></div>
        <div ng-if="data.class === 'resultGroup' || data.class === 'iterationReport'">
            <div ng-repeat="data in data.data.children" ng-include="'lib/components/analytic/groupBase.html'"></div>
        </div>

        <div ng-if="data.class === 'resultGroup' || data.class === 'iterationReport'">
            <div ng-repeat="data in data.data.links" ng-init="data=data.linkData" ng-include="'lib/components/analytic/groupBase.html'">
        </div>
    </script>

    <!-- Loop through links -->
    <script type="text/ng-template" id="link">
        <div ng-include="'display'"></div>
        <div ng-repeat="data in data.data.links" ng-init="data=data.linkData" ng-include="'lib/components/analytic/groupBase.html'">
        </div>
        <div ng-repeat="data in data.data.children" ng-include="'lib/components/analytic/groupBase.html'">
        </div>
    </script>


    <script type="text/ng-template" id="display">
        <!-- CHARTS -->

        <div ng-if="data.class === 'MethodologyChart'">
            <chart class="chart" config="configChart(data.data)"></chart>
        </div>

        <!-- ERROR MSG -->

        <div ng-if="data.class === 'errorMessage'">
        <table class="library-table">
            <thead>
                <tr>
                    <th colspan="2"><b>Error Message</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><b>Execution Status</b></td>
                    <td>{{capFirstLetter(data.status.execStatus)}}
                </tr>
                <tr>
                    <td><b>Error Message</b></td>
                    <td>{{data.data.text}}
                </tr>
            </tbody>
        </table>
        </div>

        <!-- ITERATOR -->

        <div ng-if="data.class === 'iteratorResult'">
            <div ng-if="hasResultFile(data)">
                <table align="left">
                    <tbody>
                    <tr>
                        <td width="100" valign="baseline"><h3><button ng-click="shStat = !shStat" ng-class="verdictLabel(data.status.verdict)" id="{{data.status.verdict}}">{{verdictFormat(data.status.verdict)}}</button><h3></td>
                        <td valign="middle"><h3>{{data.info.displayName}}</h3></td>
                    </tr>
                    </tbody>
                </table>

                <div>
                    <table class="library-table">
                        <tbody>
                        <tr>
                            <td><b>Explanation</b></td>
                            <td>{{data.status.verdictExplanation}}</td>
                        </tr>
                        <tr>
                            <td><b>Execution Status</b></td>
                            <td>{{capFirstLetter(data.status.execStatus)}}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div ng-show="showResult(data, shStat)">
                    <iterator-base data="data">
                </div>
            </div>
        </div>


        <div ng-if="data.class === 'tableDbQuery' || data.class ==='tableDrvDrilldown'">
            <table align="left">
                <tbody>
                <tr>
                    <td ng-hide="data.info.reportGroup === 'SUMMARY' && data.status.promoteVerdict === false" width="100" valign="baseline"><h3><button ng-click="shStat = !shStat" ng-class="verdictLabel(data.status.verdict)" id="{{data.status.verdict}}">{{verdictFormat(data.status.verdict)}}</button><h3></td>
                    <td valign="middle"><h3>{{data.info.displayName}}</h3></td>
                </tr>
                </tbody>
            </table>

            <div>
                <table class="library-table">
                    <tbody>
                    <tr>
                        <td><b>Explanation</b></td>
                        <td>{{data.status.verdictExplanation}}</td>
                    </tr>
                    <tr>
                        <td><b>Execution Status</b></td>
                        <td>{{capFirstLetter(data.status.execStatus)}}</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- DB QUERIES -->
            <div ng-if="data.class === 'tableDbQuery' || data.info.reportGroup === 'SUMMARY'">
                <div ng-show="showResult(data, shStat)">
                <table class="library-table">
                    <thead>
                    <tr>
                        <th ng-repeat="columnHeader in data.data.columnNames">{{columnHeader}}</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="row in data.data.rows">
                        {{row}}
                        <td ng-repeat="value in row track by $index">{{value}}</td>
                    </tr>
                    </tbody>
                </table>
                </div>
            </div>

            <!-- DRV DRILL DOWN -->

            <div ng-if="data.class === 'tableDrvDrilldown'">
                <div ng-show="showResult(data, shStat)">
                    <div ng-include="'lib/components/analytic/drvDrilldownBase.html'"></div>
                </div>
            </div>

        </div>

    </script>

    <div ng-include="'display'"></div>

    <div ng-if="data.class === 'resultGroup' || data.class === 'iterationReport'">
        <div ng-repeat="data in data.data.children" ng-include="'children'"></div>
    </div>

    <div ng-if="data.class === 'resultGroup' || data.class === 'iterationReport'">
        <div ng-repeat="data in data.data.links" ng-init="data=data.linkData" ng-include="'link'"></div>
    </div>
</div>
</div>
